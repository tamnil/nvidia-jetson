<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>Jetson Sensor Processing Engine (SPE) Developer Guide: UART application (app/uart-app.c)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <img src="./NVLogo_2D_H.jpg" width="204" height="44"></td>
      <td width="81%" height="44">
        <h2 style="text-align:right">Jetson Sensor Processing Engine (SPE) Developer Guide</h2>
        <h4 style="text-align:right">
        r32.2 Release</h4>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_rt-aux-cpu-demo_doc_uart.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">UART application (app/uart-app.c) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md19">For Jetson TX2</a></li>
<li class="level1"><a href="#autotoc_md20">For Jetson AGX</a></li>
</ul>
</div>
<div class="textblock"><p>UART application demonstrates how to access/manipulate Always On(AON) UARTs from the SPE/AON processor. Make sure that the kernel/bootloader is not accessing these UARTs (Usually, this can be done by modifying the device tree file). Compilation of this demo app can be controlled by "ENABLE_UART_APP" flag in the soc/*/target_specific.mk file.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
For Jetson TX2</h1>
<p>There are 2 UART ports in AON cluster for Jetson TX2:</p><ul>
<li>UARTC (base address: 0x0c280000)</li>
<li>UARTG (base address: 0x0c290000)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>UARTG is also used by SPE firmware debug message output in Jetson TX2. It's NOT recommended to use UARTG unless the end users know exactly how it works.</dd></dl>
<p>In order to access AON UART from the Cortex-R5 SPE/AON; the UART SCR and Pinmux settings need to be updated to enable access to it as described in below steps.</p>
<ol type="1">
<li>Check UART SCR settings to make sure that SPE can access the module in the file mobile_scr.cfg: <pre class="fragment">   scr.1862.2 = 0x38001414; # CLK_RST_CONTROLLER_AON_SCR_UARTC_0
</pre></li>
<li>Check the PADCTL register for the UART pins to make sure that they work in UART mode. <code>tegra186-mb1-bct-pinmux-quill-p3310-1000-a00.cfg</code>: <pre class="fragment">pinmux.0x0c302020 = 0x00000400; # uart3_tx_pw2: uartc
pinmux.0x0c302018 = 0x00000458; # uart3_rx_pw3: uartc
</pre></li>
<li>Flash the entire board to ensure that the SCR and pinmux settings are flashed on the board.</li>
<li>Check kernel device tree to make sure that kernel will not initialize UART module under test against the settings in R5 firmware. For example, in R28.2.1, UARTC is configured in DTS as following by: <div class="fragment"><div class="line">serial@c280000 {</div><div class="line">        compatible = &quot;nvidia,tegra186-hsuart&quot;;</div><div class="line">        status = &quot;okay&quot;;</div><div class="line">};</div></div><!-- fragment --> Then kernel will re-initialize UARTC by high-speed mode, which will be conflicted with R5 firmware sample code. Please comment out this part of code and upgrade the kernel DTB.</li>
</ol>
<p>After the UART test task runs, it will continuously output following messages to desired UART port: Message from SPE R5 UART And also print received characters to debug port.</p>
<ol type="1">
<li>A simple way to test UARTC function in Jetson TX2 board. 5.1 Follow above steps from 1 to 4 and power up the device. 5.2 Use a wire to connect UARTC TX and Rx (in Jetson TX2 carrier board, they are pin 5 and 4 in J17), then the following message will output from SPE firmware debug UART port, i.e. UARTG: Message from SPE R5 UART</li>
</ol>
<h1><a class="anchor" id="autotoc_md20"></a>
For Jetson AGX</h1>
<p>There are 2 UART ports in AON cluster for Jetson AGX:</p><ul>
<li>UARTC (base address: 0x0c280000) (See Warning below!)</li>
<li>UARTG (base address: 0x0c290000)</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>UARTC is the default system debug UART port in Jetson AGX. PLEASE DO NOT ACCESS UARTC IN R5 FIRMWARE. OR THE SYSTEM MAY MALFUNCTION!</dd></dl>
<p>In order to access a AON UART from the Cortex-R5 SPE/AON for Jetson AGX; the UART SCR, and pinmux settings need to be updated as described in below steps.</p>
<ol type="1">
<li>Check SCR values as below in the file tegra194-mb1-bct-scr-cbb-mini.cfg: <pre class="fragment">scr.2609.6 = 0x18001616; # AON_NOC_UARTG_BLF_CONTROL_REGISTER_0
</pre></li>
<li>Check default pinmux configuration as below in the file <code>tegra19x-mb1-pinmux-p2888-0000-a04-p2822-0000-b01.cfg</code>. <pre class="fragment">pinmux.0x0c302048 = 0x00000401; # spi2_sck_pcc0: uartg,
pinmux.0x0c302050 = 0x00000459; # spi2_miso_pcc1: uartg,
</pre></li>
<li><p class="startli">Compile device tree and flash the entire board to ensure that the SCR, and pinmux settings are flashed on the board.</p>
<p class="startli">After the UART test task runs, it will continuously output following messages to desired UART port: </p><pre class="fragment">Message from SPE R5 UART
</pre><p> It will also print received characters to debug port.</p>
</li>
<li><p class="startli">A simple way to test UARTG function in Jetson AGX board.</p>
<p class="startli">4.1. Follow above steps from 1 to 3 and power up the device.</p>
<p class="startli">4.2. Use a wire to connect UARTG TX and Rx (in Jetson AGX board, they are A5 and A6 in J6), then the following message will output from SPE firmware debug UART port: </p><pre class="fragment">Message from SPE R5 UART</pre> </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Tue Jul 2 2019 13:38:41 |
        09482-R32
      </li>
     </ul>
  </div>
</body>
</html>

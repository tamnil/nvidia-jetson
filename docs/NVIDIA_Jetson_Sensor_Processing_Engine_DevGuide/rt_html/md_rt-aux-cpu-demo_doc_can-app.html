<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>Jetson Sensor Processing Engine (SPE) Developer Guide: CAN Application (app/can-app.c)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <img src="./NVLogo_2D_H.jpg" width="204" height="44"></td>
      <td width="81%" height="44">
        <h2 style="text-align:right">Jetson Sensor Processing Engine (SPE) Developer Guide</h2>
        <h4 style="text-align:right">
        r32.2 Release</h4>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_rt-aux-cpu-demo_doc_can-app.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">CAN Application (app/can-app.c) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md7">Compiling the Application</a></li>
<li class="level1"><a href="#autotoc_md8">Prerequisites</a></li>
<li class="level1"><a href="#autotoc_md9">Operation</a></li>
<li class="level1"><a href="#autotoc_md10">Wiring Details</a></li>
<li class="level1"><a href="#autotoc_md11">Jetson TX2 Configuration</a></li>
<li class="level1"><a href="#autotoc_md12">Jetson AGX Configuration</a></li>
</ul>
</div>
<div class="textblock"><p>This section explains how to use the CAN application on NVIDIA<sup>&reg;</sup> Jetson<sup>&trade;</sup> TX 2 and AGX.</p>
<p>There are two CAN controllers, which run in Always On (AON) mode. As such, the APIs that interface with those controllers are called AON CAN controller driver APIs. This application demonstrates how to use them.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Compiling the Application</h1>
<p>To control compilation of the CAN application, use the <code>ENABLE_CAN_APP</code> flag in the <code>soc/*/target_specific.mk</code> file.</p>
<dl class="section note"><dt>Note</dt><dd>It is required to compile device tree and flash board to have device tree and SCR settings updated after making kernel device tree and SCR changes as described in following sections.</dd></dl>
<h1><a class="anchor" id="autotoc_md8"></a>
Prerequisites</h1>
<p>Before you can to successfully execute the application, you must obtain two CAN transceivers. The transceivers must be 3.3V I/O compatible, similar to the ones at:</p>
<p><a href="https://www.amazon.com/SN65HVD230-CAN-Board-Communication-Development/dp/B00KM6XMXO">https://www.amazon.com/SN65HVD230-CAN-Board-Communication-Development/dp/B00KM6XMXO</a></p>
<h1><a class="anchor" id="autotoc_md9"></a>
Operation</h1>
<p>By default, the CAN AON controller driver sets the bit rate at 500-kilobits per second and the data bit rate at 2-megabits per second. For more information, see the <code>mttcan_controller_init</code> function in the <code>tegra-can.c</code> driver source file.</p>
<p>The application uses both AON CAN controllers. It also connects the CAN 0 bus to CAN 1, using the above mentioned CAN transceivers, where:</p><ul>
<li>CAN 0 transmits pre-defined messages and</li>
<li>CAN 1 receives such messages.</li>
</ul>
<p>The application prints the message details received at CAN 1 bus. It also prints the transmit element, which includes information about the transmitted message. The transmit element is also created when there is a bus state change. Below is the sample output that is printed on successful transmission. </p><pre class="fragment">Transmited message from CAN 0
Transmission complete event
Transmit event element information:
Message ID: 0xa5, Event Type: Tx event, CAN Frame: &lt;frame details&gt;
Message received at CAN 1
Message ID: 0xa5, Message data length: 2
Message Data:
0xaa 0x55
</pre><h1><a class="anchor" id="autotoc_md10"></a>
Wiring Details</h1>
<div class="fragment"><div class="line">------------------    ----------------------        -------------------     ----------------------</div><div class="line">|                |    |                    |        |                 |     |                    |</div><div class="line">|             TX |---&gt;| TX           CAN H |&lt;------&gt;|CAN H         TX |&lt;----| TX                 |</div><div class="line">| AON CAN0       |    |   CAN Transceiver  |        |  CAN Transceiver|     | AON CAN1 Controller|</div><div class="line">| Controller  RX |&lt;---| RX           CAN L |&lt;------&gt;|CAN H         RX |----&gt;| RX                 |</div><div class="line">|                |    |                    |        |                 |     |                    |</div><div class="line">------------------    ----------------------        -------------------     ----------------------</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>It is recommended to use termination between CAN devices according to CAN specifications.</dd></dl>
<h1><a class="anchor" id="autotoc_md11"></a>
Jetson TX2 Configuration</h1>
<p>Ensure the CAN is disabled in the kernel device tree <code>tegra186-quill-p3310-1000-c03-00-base.dts</code> as shown below: </p><div class="fragment"><div class="line">mttcan@c310000 {</div><div class="line">        status = &quot;disabled&quot;;</div><div class="line">        ...</div><div class="line">};</div><div class="line">mttcan@c320000 {</div><div class="line">        status = &quot;disabled&quot;;</div><div class="line">        ...</div><div class="line">};</div></div><!-- fragment --><p>CAN 0 and 1 controller TX and RX are brought out to 30 pin header J26 as below:</p><ul>
<li>Pin 2 - 3.3V</li>
<li>Pin 10 - GND</li>
<li>Pin 5 - CAN0_RX &mdash;&gt; Connects RX pin of CAN transceiver</li>
<li>Pin 7 - CAN0_TX &mdash;&gt; Connects TX pin of CAN transceiver</li>
<li>Pin 15 - CAN1_RX &mdash;&gt; Connects RX pin of CAN transceiver</li>
<li>Pin 17 - CAN1_TX &mdash;&gt; Connects TX pin of CAN transceiver</li>
</ul>
<p>Additional 3.3V and GND connections are available at 40 pin header J21 as below:</p><ul>
<li>Pin 1, 17 - 3.3V</li>
<li>Pin 25, 39 - GND</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
Jetson AGX Configuration</h1>
<p>Ensure the CAN is disabled in the kernel device tree <code>tegra194-p2888-0001-p2822-0000-common.dtsi</code> as shown below: </p><div class="fragment"><div class="line">mttcan@c310000 {</div><div class="line">        status = &quot;disabled&quot;;</div><div class="line">        ...</div><div class="line">};</div><div class="line">mttcan@c320000 {</div><div class="line">        status = &quot;disabled&quot;;</div><div class="line">        ...</div><div class="line">};</div></div><!-- fragment --><p>Modify SCR setting in tegra194-mb1-bct-scr-cbb-mini.cfg as follows:</p>
<ul>
<li>scr.378.4 = 0x1a0034ff; # CLK_RST_CONTROLLER_AON_SCR_CAN_0</li>
<li>scr.407.4 = 0x1a0034ff; # CLK_RST_CONTROLLER_CAN1_SCR_FMON_0</li>
<li>scr.408.4 = 0x1a0034ff; # CLK_RST_CONTROLLER_CAN2_SCR_FMON_0</li>
<li>scr.2602.6 = 0x19003232; # AON_NOC_CAN1_BLF_CONTROL_REGISTER_0</li>
<li>scr.2603.6 = 0x19003232; # AON_NOC_CAN2_BLF_CONTROL_REGISTER_0</li>
</ul>
<p>Modify pinmux setting in tegra19x-mb1-pinmux-p2888-0000-a04-p2822-0000-b01.cfg as follows:</p>
<ul>
<li>pinmux.0x0c303000 = 0x00000400; # can1_dout_paa0: rsvd1, pull-down, tristate-enable, input-enable</li>
<li>pinmux.0x0c303008 = 0x00000458; # can1_din_paa1: rsvd1, pull-down, tristate-enable, input-enable</li>
<li>pinmux.0x0c303010 = 0x00000400; # can0_dout_paa2: rsvd1, pull-up, tristate-enable, input-enable</li>
<li>pinmux.0x0c303018 = 0x00000458; # can0_din_paa3: rsvd1, pull-up, tristate-enable, input-enable</li>
</ul>
<p>CAN 0 and 1 controller TX and RX are brought out to 40 pin header J30 as below:</p><ul>
<li>Pin 1, 17 - 3.3V</li>
<li>Pin 9, 25, 39 - GND</li>
<li>Pin 29 - CAN0_RX &mdash;&gt; Connects RX pin of CAN transceiver</li>
<li>Pin 31 - CAN0_TX &mdash;&gt; Connects TX pin of CAN transceiver</li>
<li>Pin 37 - CAN1_RX &mdash;&gt; Connects RX pin of CAN transceiver</li>
<li>Pin 33 - CAN1_TX &mdash;&gt; Connects TX pin of CAN transceiver </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Tue Jul 2 2019 13:38:41 |
        09482-R32
      </li>
     </ul>
  </div>
</body>
</html>
